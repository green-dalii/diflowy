---
import Footer from "../components/ui/Footer.astro";
import Navbar from "../components/ui/Navbar.astro";
import MainHead from "./MainHead.astro";
import i18next from "i18next";
import defaultConfig from "../../astro-i18next.config.mjs";

// Get the user's preferred language
const userLanguage = navigator.language || navigator.languages[0];
const supportedLanguages = defaultConfig.locales;

// Get the user's preferred language short code
const userLanguageShort = userLanguage.split('-')[0];

// Check if the user's preferred language is supported
if (supportedLanguages.includes(userLanguageShort)) {
  i18next.changeLanguage(userLanguageShort);
} else {
  i18next.changeLanguage('en');
}

const { ...props } = Astro.props;
---

<html lang={i18next.language}>
  <MainHead {...props} />
  <style>
    html.lenis {
      height: auto;
    }
    .lenis.lenis-smooth {
      scroll-behavior: auto;
    }
    .lenis.lenis-smooth [data-lenis-prevent] {
      overscroll-behavior: contain;
    }
    .lenis.lenis-stopped {
      overflow: hidden;
    }
  </style>
  <script src="../utils/lenis"></script>
  <body>
    <main>
      <Navbar />
      <slot />
      <Footer />
    </main>
  </body>
</html>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    setDocumentDirection();
  });

  function setDocumentDirection() {
    const pathPrefix = "/ar";
    if (window.location.pathname.startsWith(pathPrefix)) {
      document.documentElement.dir = "rtl";
    } else {
      document.documentElement.dir = "ltr";
    }
  }
</script>
<!-- Cloudflare Web Analytics -->
<script
  type="module"
  src="https://static.cloudflareinsights.com/beacon.min.js"
  data-cf-beacon='{"token": "94c3b9290009489fb3a79d942819c12f"}'></script>
<!-- End Cloudflare Web Analytics -->
